var sql = require('../helpers/db.js');

var inputToData = function(input) {
        return {
                name    : input.newname
        };
}

var resourceName = 'pratiche';
var tableName = 'Pratiche';


exports.list = function(req, res, next) {

    var username = req.body.user || req.query.user || req.headers['x-access-user'] || req.cookies.user;

        sql(function(err,connection) {
                connection.query('SELECT * FROM '+tableName, function(err, rows){
                        if (err) throw err;
                    res.render(resourceName, { page_title:tableName, data:rows, user:username });
                });
        });
};

exports.save = function(req, res){
        var input = JSON.parse(JSON.stringify(req.body));

        sql(function (err, connection) {
                var data = inputToData(input);

                connection.query('INSERT INTO '+tableName+' set ? ', data, function(err, rows) {
                        if (err) console.log("Error inserting : %s ",err );
                        res.redirect('/'+resourceName);
                });
        });
}

exports.edit = function(req, res){
        var input = JSON.parse(JSON.stringify(req.body));
        var id = req.params.id;

        sql(function (err, connection) {
                var data = inputToData(input);

                connection.query('UPDATE '+tableName+' set ? WHERE id = ? ', [data, id], function(err, rows) {
                        if (err) console.log("Error Updating : %s ",err );
                        res.redirect('/'+resourceName);
                });
        });
}

exports.delete = function(req, res){
        var id = req.params.id;

        sql(function (err, connection) {
                connection.query('DELETE FROM '+tableName+' WHERE id = ? ', [id], function(err, rows) {
                        if (err) console.log("Error deleting : %s ", err);
                        res.redirect('/'+resourceName);
                });
        });
}


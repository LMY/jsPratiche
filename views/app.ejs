<html ng-app="app">
<head>
	<title>jsPratiche!</title>
	<style>
	body {
		font: 20px Montserrat, sans-serif;
		line-height: 1.8;
		color: #f5f6f7;
	}
	.bg-4 {
		margin: 30px;
		background-color: #f8f8f8;
		color: #777777;
	}
	</style>
</head>
<body>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script> 
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular-route.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular-resource.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<ng-view></ng-view>

<script type="text/ng-template" id="/main.html">
	<div ng-include="'/public/navbar.html'"></div>
	<div class = "container">
	<div class = "jumbotron">
		<h1>Welcome to jsPratiche!</h1>
		<p>Scegli dal menu in alto una voce.</p>
	</div>
</script>


<script type="text/ng-template" id="/pratiche.html">
<div ng-include="'/public/navbar.html'"></div>
	<div class="form-group">
		<div class="span7 text-center">
			<button class="btn btn-primary" ng-click="new()">Nuova Pratica</button>
		</div>
	</div>
	
	<table class="table table-hover">
		<thead>
			<tr>
				<th>ID</th>
				<th class="text-center">Gestore</th>
				<th class="text-center">Comune</th>
				<th>Indirizzo</th>
				<th class="text-center">CodiceSito</th>
				<th class="text-center">TipoPratica</th>
				<th class="text-center">ProtoIN</th>
				<th class="text-center">DateIN</th>
				<th>note</th>
			</tr>
		</thead>
		<tbody>
			<tr ng-repeat="x in pratiche" ng-click="show(x.id)">
				<td class="text-center">{{x.id}}</td>
				<td class="text-center">{{x.nameGestore}}</td>
				<td class="text-center">{{x.nameComune}}</td>
				<td>{{x.address}}</td>
				<td class="text-center">{{x.sitecode}}</td>
				<td class="text-center">{{x.nameTipo}}</td>
				<td class="text-center">{{x.protoIN}}</td>
				<td class="text-center">{{x.dataIN}}</td>
				<td>{{x.note}}</td>
			</tr>
		</tbody>
	</table>
</script>

<script type="text/ng-template" id="/praticaDetails.html">
<div ng-include="'/public/navbar.html'"></div>	
<div class="container">
  <h2>{{ title }}</h2>
  <form class="form-horizontal" role="form">
    <div class="form-group">
      <label class="control-label col-sm-2" for="gestore">Gestore:</label>
      <div class="col-sm-10">
		<select data-ng-options="g.id as g.name for g in gestori" data-ng-model="epratica.idGestore"></select>
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2" for="comune">Comune:</label>
      <div class="col-sm-10">
		<select data-ng-options="g.id as g.name for g in comuni" data-ng-model="epratica.idComune"></select>
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="address">Indirizzo:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" id="address" ng-model="epratica.address" placeholder="Indirizzo">
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="sitecode">Codice Sito:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" id="sitecode" ng-model="epratica.sitecode" placeholder="Codice Sito">
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="tipopratica">Tipo Pratica:</label>
      <div class="col-sm-10">
		<select data-ng-options="g.id as g.descrizione for g in consttipipratiche" data-ng-model="epratica.tipopratica"></select> 
      </div>
    </div>	
	<div class="form-group">
      <label class="control-label col-sm-2" for="protoIN">Proto IN:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" id="protoIN" ng-model="epratica.protoIN" placeholder="Proto IN">
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="dataIN">Data IN:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" id="dataIN" ng-model="epratica.dataIN" placeholder="Data IN">
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="protoOUT">Proto OUT:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" id="protoOUT" ng-model="epratica.protoOUT" placeholder="Proto OUT">
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="dataOUT">Data OUT:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" id="dataOUT" ng-model="epratica.dataOUT" placeholder="Data OUT">
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="note">Note:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" id="note" ng-model="epratica.note" placeholder="Note">
      </div>
    </div>
    <div class="form-group">        
      <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" class="btn btn-success" ng-show="!isnew" ng-click="update()">Update</button>
		<button type="submit" class="btn btn-success" ng-show="isnew" ng-click="update()">Create</button>
        <button type="submit" class="btn btn-default" ng-click="cancel()">Cancel</button>
        <div class="pull-right"><button type="submit" class="btn btn-danger" ng-show="!isnew" confirmed-click="remove()" ng-confirm-click="Sei sicuro?">Remove</button></div>
      </div>
    </div>
  </form>
</div>
</script>

<script type="text/ng-template" id="/praticaStatoDetails.html">
<div ng-include="'/public/navbar.html'"></div>	
<div class="container">
	<h2>{{ title }}</h2>
	<div>{{ infoline }}</div>
	<div>
		div coi bottoni: tipo {{ epratica.idStato }}
		<button class="btn btn-default" ng-click="cancel()">Indietro</button>
		<button class="btn btn-success" ng-click="show()">Modifica</button>
	</div>
	<div>
		<table class="table table-hover">
			<thead>
				<tr>
					<th>ID</th>
					<th>Stato</th>
					<th>Utente</th>
					<th>Quando</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="x in stati">
					<td>{{x.id}}</td>
					<td>{{x.stato}}</td>
					<td>{{x.username}}</td>
					<td>{{x.timepoint}}</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>
</script>


<script type="text/ng-template" id="/anagrafiche.html">
	<div ng-include="'/public/navbar.html'"></div>
	<div class="form-group">
		<div class="span7 text-center">
			<button class="btn btn-primary" ng-click="new()">Nuovo Gestore</button>
		</div>
	</div>
	<table class="table table-hover">
		<thead>
			<tr>
				<th>ID</th>
				<th>Name</th>
				<th>PEC</th>
			</tr>
		</thead>
		<tbody>
			<tr ng-repeat="x in anagrafiche" ng-click="show(x.id)">
				<td>{{x.id}}</td>
				<td>{{x.name}}</td>
				<td>{{x.pec}}</td>
			</tr>
		</tbody>
	</table>
</script>

<script type="text/ng-template" id="/gestoreDetails.html">
	<div ng-include="'/public/navbar.html'"></div>	
<div class="container">
  <h2>{{ title }}</h2>
  <form class="form-horizontal" role="form">
    <div class="form-group">
      <label class="control-label col-sm-2" for="name">Name:</label>
      <div class="col-sm-10">
        <input type="text" class="form-control" id="name" ng-model="egestore.name" placeholder="Nome gestore">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2" for="pec">Pec:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" id="pec" ng-model="egestore.pec" placeholder="PEC gestore">
      </div>
    </div>
    <div class="form-group">        
      <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" class="btn btn-success" ng-show="!isnew" ng-click="update()">Update</button>
		<button type="submit" class="btn btn-success" ng-show="isnew" ng-click="update()">Create</button>
        <button type="submit" class="btn btn-default" ng-click="cancel()">Cancel</button>
        <div class="pull-right"><button type="submit" class="btn btn-danger" ng-show="!isnew" confirmed-click="remove()" ng-confirm-click="Sei sicuro?">Remove</button></div>
      </div>
    </div>
  </form>
</div>
</script>

<script type="text/ng-template" id="/comuneDetails.html">
	<div ng-include="'/public/navbar.html'"></div>
<div class="container">
  <h2>{{ title }}</h2>
  <form class="form-horizontal" role="form">
    <div class="form-group">
      <label class="control-label col-sm-2" for="name">Name:</label>
      <div class="col-sm-10">
        <input type="text" class="form-control" id="name" ng-model="ecomune.name" placeholder="Nome comune">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2" for="pec">Pec:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" id="pec" ng-model="ecomune.pec" placeholder="PEC comune">
      </div>
    </div>
    <div class="form-group">        
      <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" class="btn btn-success" ng-show="!isnew" ng-click="update()">Update</button>
		<button type="submit" class="btn btn-success" ng-show="isnew" ng-click="update()">Create</button>
        <button type="submit" class="btn btn-default" ng-click="cancel()">Cancel</button>
        <div class="pull-right"><button type="submit" class="btn btn-danger" ng-show="!isnew" confirmed-click="remove()" ng-confirm-click="Sei sicuro?">Remove</button></div>
      </div>
    </div>
  </form>
</div>
</script>

<script type="text/ng-template" id="/utenti.html">
	<div ng-include="'/public/navbar.html'"></div>
	<div class="form-group">
		<div class="span7 text-center">
			<button class="btn btn-primary" ng-click="new()">Nuovo Utente</button>
		</div>
	</div>
	<table class="table table-hover">
		<thead>
			<tr>
				<th>ID</th>
				<th>Username</th>
				<th>Name</th>
				<th>Surname</th>
				<th>Email</th>
				<th>Phone</th>
				<th>Last Login</th>
				<th>UserLevel</th>
			</tr>
		</thead>
		<tbody>
			<tr ng-repeat="utente in utenti" ng-click="show(utente.id)">
				<td>{{utente.id}}</td>
				<td>{{utente.username}}</td>
				<td>{{utente.name}}</td>
				<td>{{utente.surname}}</td>
				<td>{{utente.email}}</td>
				<td>{{utente.phone}}</td>
				<td>{{utente.lastlogin}}</td>
				<td>{{utente.userlevel}}</td>
			</tr>
		</tbody>
	</table>
</script>

<script type="text/ng-template" id="/utenteDetails.html">
	<div ng-include="'/public/navbar.html'"></div>
<div class="container">
  <h2>{{ title }}</h2>
  <form class="form-horizontal" role="form">
    <div class="form-group">
      <label class="control-label col-sm-2" >Username:</label>
      <div class="col-sm-10">
        <input type="text" class="form-control" ng-model="eutente.username" placeholder="Username">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">Name:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" ng-model="eutente.name" placeholder="Name">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">Surname:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" ng-model="eutente.surname" placeholder="Surname">
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2">Email:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" ng-model="eutente.email" placeholder="Email">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">Phone:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" ng-model="eutente.phone" placeholder="Phone">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">Level:</label>
      <div class="col-sm-10">          
        <input type="text" class="form-control" ng-model="eutente.userlevel" placeholder="Level">
      </div>
    </div>	
    <div class="form-group">        
      <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" class="btn btn-success" ng-show="!isnew" ng-click="update()">Update</button>
		<button type="submit" class="btn btn-success" ng-show="isnew" ng-click="update()">Create</button>
        <button type="submit" class="btn btn-default" ng-click="cancel()">Cancel</button>
        <div class="pull-right">
			<button type="submit" class="btn btn-primary" ng-show="!isnew" ng-click="changepw()">Cambia Password</button>
			<button type="submit" class="btn btn-danger" ng-show="!isnew" confirmed-click="remove()" ng-confirm-click="Sei sicuro?">Remove</button>
		</div>
      </div>
    </div>
  </form>
</div>
</script>

<script type="text/ng-template" id="/utentePass.html">
	<div ng-include="'/public/navbar.html'"></div>
	<div class="container">
	<h2>{{ title }} - {{eutente.username}}</h2>
	<form class="form-horizontal" role="form">

		<div class="form-group">
		  <label class="control-label col-sm-2">Vecchia Password:</label>
		  <div class="col-sm-10">          
			<input type="password" class="form-control" ng-model="eutente.oldpassword">
		  </div>
		</div>
		
		<div class="form-group">
		  <label class="control-label col-sm-2">Password:</label>
		  <div class="col-sm-10">          
			<input type="password" class="form-control" ng-model="eutente.password1">
		  </div>
		</div>
		
		<div class="form-group">
		  <label class="control-label col-sm-2">Ripeti Password:</label>
		  <div class="col-sm-10">          
			<input type="password" class="form-control" ng-model="eutente.password2">
		  </div>
		</div>
		
		<div class="form-group">        
		  <div class="col-sm-offset-2 col-sm-10">
			<button type="submit" class="btn btn-success" ng-click="update()">Update</button>
			<button type="submit" class="btn btn-default" ng-click="cancel()">Cancel</button>
		  </div>
		</div>
	</form>
</div>
</script>



<script>var app = angular.module('app', ['ngRoute', 'ngResource'])
	.factory('Gestori', ['$resource', function($resource){
		return $resource('/gestori/:id', null, {
			'update': { method:'PUT' }
		});
	}])
	.factory('Comuni', ['$resource', function($resource){
		return $resource('/comuni/:id', null, {
			'update': { method:'PUT' }
		});
	}])
	.factory('Utenti', ['$resource', function($resource){
		return $resource('/utenti/:id', null, {
			'update': { method:'PUT' }
		});
	}])
	.factory('Pratiche', ['$resource', function($resource){
		return $resource('/pratiche/:id', null, {
			'update': { method:'PUT' }
		});
	}])
	.factory('Integrazioni', ['$resource', function($resource){
		return $resource('/integrazioni/:id', null, {
			'update': { method:'PUT' }
		});
	}])
	.factory('ConstStatiPratiche', ['$resource', function($resource){
		return $resource('/statopratiche/stati', null);
	}])
	.factory('ConstTipiPratiche', ['$resource', function($resource){
		return $resource('/statopratiche/tipi', null);
	}])		
	.factory('StatoPratiche', ['$resource', function($resource){
		return $resource('/statopratiche/current/:id', null, {
			'update': { method:'PUT' }
		});
	}])
	.factory('StoricoStatoPratiche', ['$resource', function($resource){
		return $resource('/statopratiche/:id', null, {
			'update': { method:'PUT' }
		});
	}])
	.factory('Me', ['$resource', function($resource){
		return $resource('/utenti/me', null);
	}])	
	
	.controller('GestoriController', ['$scope', 'Me', 'Gestori', '$location', function($scope, Me, Gestori, $location) {
		$scope.me = Me.get();
		$scope.anagrafiche = Gestori.query();
		
		$scope.new = function() {
			$location.url('gestori/new');
		}

		$scope.show = function(id) {
			$location.url('gestori/'+id);
		}
	}])
  	.controller('MainController', ['$scope', 'Me', '$location', function($scope, Me, $location) {
		$scope.me = Me.get();
	}])
	
	.controller('GestoreDetailCtrl', ['$scope', '$routeParams', 'Me','Gestori', '$location', function($scope, $routeParams, Me, Gestori, $location) {
		$scope.me = Me.get();
		$scope.isnew = ($routeParams.id === "new");
		$scope.egestore = $scope.isnew ? {} : Gestori.get({id: $routeParams.id });
		$scope.title = $scope.isnew ? "Nuovo Gestore" : "Gestore "+$routeParams.id;
		
		$scope.update = function( ){
			if ($scope.isnew) {
				if (!$scope.egestore || $scope.egestore.length < 1) return;
				var gestore = new Gestori({ name: $scope.egestore.name, pec: $scope.egestore.pec });
				gestore.$save(function(){
					$location.url('gestori');					
				});
			}
			else
				Gestori.update({id: $scope.egestore.id}, $scope.egestore, function() {
					$location.url('gestori');
				});
		}
		
		$scope.remove = function() {
			Gestori.remove({id: $scope.egestore.id}, function() {
				$location.url('gestori');
			});
		}
		
		$scope.cancel = function() {
			$location.url('gestori');
		}
	}])
	
	
	.controller('ComuneController', ['$scope', 'Me', 'Comuni', '$location', function($scope, Me, Comuni, $location) {
		$scope.me = Me.get();
		$scope.anagrafiche = Comuni.query();
		
		$scope.new = function() {
			$location.url('comuni/new');
		}
		$scope.show = function(id) {
			$location.url('comuni/'+id);
		}
	}])
	.controller('ComuneDetailCtrl', ['$scope', '$routeParams', 'Me', 'Comuni', '$location', function($scope, $routeParams, Me, Comuni, $location) {
		$scope.isnew = ($routeParams.id === "new");
		$scope.ecomune = $scope.isnew ? {} : Comuni.get({id: $routeParams.id });
		$scope.title = $scope.isnew ? "Nuovo Comune" : "Comune "+$routeParams.id;
		
		$scope.update = function( ){
			if ($scope.isnew) {
				if (!$scope.ecomune || $scope.ecomune.length < 1) return;
				var comune = new Comuni({ name: $scope.ecomune.name, pec: $scope.ecomune.pec });
				comune.$save(function(){
					$location.url('comuni');					
				});
			}
			else
				Comuni.update({id: $scope.ecomune.id}, $scope.ecomune, function() {
					$location.url('comuni');
				});
		}
		
		$scope.remove = function() {
			Comuni.remove({id: $scope.ecomune.id}, function() {
				$location.url('comuni');
			});
		}
		
		$scope.cancel = function() {
			$location.url('comuni');
		}
	}])

	.controller('UtentiController', ['$scope', 'Me', 'Utenti', '$location', function($scope, Me, Utenti, $location) {
		$scope.me = Me.get();
		$scope.utenti = Utenti.query();
		
		$scope.new = function() {
			$location.url('utenti/new');
		}
		$scope.show = function(id) {
			$location.url('utenti/'+id);
		}
	}])
	.controller('UtenteDetailCtrl', ['$scope', '$routeParams', 'Me', 'Utenti', '$location', function($scope, $routeParams, Me, Utenti, $location) {
		$scope.me = Me.get();
		$scope.isnew = ($routeParams.id === "new");
		$scope.eutente = $scope.isnew ? {} : Utenti.get({id: $routeParams.id });
		$scope.title = $scope.isnew ? "Nuovo Utente" : "Utente "+$routeParams.id;
		
		$scope.update = function( ){
			if ($scope.isnew) {
				if (!$scope.eutente || $scope.eutente.length < 1) return;
				
				var utente = new Utenti({ username: $scope.eutente.username, name: $scope.eutente.name, surname: $scope.eutente.surname, email: $scope.eutente.email, phone: $scope.eutente.phone });
				utente.$save(function(){
					$location.url('utenti');					
				});
			}
			else
				Utenti.update({id: $scope.eutente.id}, $scope.eutente, function() {
					$location.url('utenti');
				});
		}
		
		$scope.remove = function() {
			Utenti.remove({id: $scope.eutente.id}, function() {
				$location.url('utenti');
			});
		}
		
		$scope.cancel = function() {
			$location.url('utenti');
		}
		
		$scope.changepw = function() {
			$location.url('utenti/pass/'+$scope.eutente.id);
		}
	}])
	
	.controller('UtentePassCtrl', ['$scope', '$http', '$routeParams', 'Me', 'Utenti', '$location', function($scope, $http, $routeParams, Me, Utenti, $location) {
		$scope.me = Me.get();
		$scope.eutente = Utenti.get({id: $routeParams.id });
		$scope.title = "Utente "+$routeParams.id;
		
		$scope.update = function( ){
			
			if ($scope.eutente.password1 != $scope.eutente.password2) {
				alert("Le password non corrispondono");
				return;
			}
			
			var data = $.param({
                oldpassword: $scope.eutente.oldpassword,
                password: $scope.eutente.password1
            });
			
			$http({ method: 'PUT', url: '/utenti/password/'+$routeParams.id, 
				data: data,
				headers: {'Content-Type': 'application/x-www-form-urlencoded'}			
			}).then(
				function(res) { $location.url('utenti'); },
				function(err) { alert("Error: "+err); }
			);
		}

		$scope.cancel = function() {
			$location.url('utenti');
		}
	}])
	
	.controller('PraticheController', ['$scope', 'Me', 'Pratiche', '$location', function($scope, Me, Pratiche, $location) {
		$scope.me = Me.get();
		$scope.pratiche = Pratiche.query(function() {
			$scope.pratiche.forEach(function(x) {
				if (x.dataIN) x.dataIN = x.dataIN.substring(0, 10);
				if (x.dataOUT) x.dataOUT = x.dataOUT.substring(0, 10);
			});
		});
		
		$scope.new = function() {
			$location.url('pratiche/detail/new');
		}
		$scope.show = function(id) {
			$location.url('pratiche/'+id);
		}
	}])
	.controller('PraticaDetailController', ['$scope', '$routeParams', 'Pratiche', 'Gestori', 'Me', 'Utenti', 'Comuni', 'Integrazioni', 'ConstStatiPratiche', 'ConstTipiPratiche', '$location', function($scope, $routeParams, Pratiche, Gestori, Me, Utenti, Comuni, Integrazioni, ConstStatiPratiche, ConstTipiPratiche, $location) {
		$scope.me = Me.get();
		$scope.isnew = ($routeParams.id === "new");
		$scope.epratica = $scope.isnew ? {} : Pratiche.get({id: $routeParams.id }, function(x) {
			if (x.dataIN) x.dataIN = x.dataIN.substring(0, 10);
			if (x.dataOUT) x.dataOUT = x.dataOUT.substring(0, 10);
		});
		$scope.title = $scope.isnew ? "Nuova Pratica" : "Pratica "+$routeParams.id;
		
		$scope.gestori = Gestori.query();
		$scope.comuni = Comuni.query();
		$scope.utenti = Utenti.query();

		$scope.integrazioni = Integrazioni.query();
		$scope.conststatipratiche = ConstStatiPratiche.query();
		$scope.consttipipratiche = ConstTipiPratiche.query();
		
		$scope.update = function( ){
			if ($scope.isnew) {
				if (!$scope.epratica) return;

				var pratica = new Pratiche({ idGestore: $scope.epratica.idGestore, idComune: $scope.epratica.idComune, address: $scope.epratica.address, sitecode: $scope.epratica.sitecode, tipopratica: $scope.epratica.tipopratica, protoIN: $scope.epratica.protoIN, dataIN: $scope.epratica.dataIN, protoOUT: $scope.epratica.protoOUT, dataOUT: $scope.epratica.dataOUT, note: $scope.epratica.note });
				
				pratica.$save(function(){
					$location.url('pratiche');
				});
			}
			else
				Pratiche.update({id: $scope.epratica.id}, $scope.epratica, function() {
					$location.url('pratiche');
				});
		}

		$scope.cancel = function() {
			$location.url('pratiche');
		}
		
		$scope.remove = function() {
			Pratiche.remove({id: $scope.epratica.id}, function() {
				$location.url('pratiche');
			});
		}
	}])
		.controller('PraticaStatoDetailController', ['$scope', '$routeParams', 'Pratiche', 'Gestori', 'Me', 'Utenti', 'Comuni', 'Integrazioni', 'ConstStatiPratiche', 'ConstTipiPratiche', '$location', function($scope, $routeParams, Pratiche, Gestori, Me, Utenti, Comuni, Integrazioni, ConstStatiPratiche, ConstTipiPratiche, $location) {
		$scope.me = Me.get();
		$scope.isnew = ($routeParams.id === "new");
		$scope.epratica = $scope.isnew ? {} : Pratiche.get({id: $routeParams.id }, function(x) {
			if (x.dataIN) x.dataIN = x.dataIN.substring(0, 10);
			if (x.dataOUT) x.dataOUT = x.dataOUT.substring(0, 10);
		});
		$scope.title = $scope.isnew ? "Nuova Pratica" : "Pratica "+$routeParams.id;
		
		$scope.gestori = Gestori.query();
		$scope.comuni = Comuni.query();
		$scope.utenti = Utenti.query();

		$scope.integrazioni = Integrazioni.query();
		$scope.conststatipratiche = ConstStatiPratiche.query();
		$scope.consttipipratiche = ConstTipiPratiche.query();
		
		$scope.cancel = function() {
			$location.url('pratiche');
		}
		
		$scope.show = function() {
			$location.url('pratiche/detail/'+$scope.epratica.id);
		}
	}])
	
	.config(['$routeProvider', function($routeProvider) {
		$routeProvider
			.when('/', {
				templateUrl: '/main.html',
				controller: 'MainController'
			})
			.when('/gestori', {
				templateUrl: '/anagrafiche.html',
				controller: 'GestoriController'
			})
			.when('/gestori/:id', {
				templateUrl: '/gestoreDetails.html',
				controller: 'GestoreDetailCtrl'
			})
			.when('/comuni', {
				templateUrl: '/anagrafiche.html',
				controller: 'ComuneController'
			})
			.when('/comuni/:id', {
				templateUrl: '/comuneDetails.html',
				controller: 'ComuneDetailCtrl'
			})
			.when('/pratiche', {
				templateUrl: '/pratiche.html',
				controller: 'PraticheController'
			})			
			.when('/pratiche/detail/:id', {
				templateUrl: '/praticaDetails.html',
				controller: 'PraticaDetailController'
			})
			.when('/pratiche/:id', {
				templateUrl: '/praticaStatoDetails.html',
				controller: 'PraticaStatoDetailController'
			})
			.when('/utenti', {
				templateUrl: '/utenti.html',
				controller: 'UtentiController'
			})
			.when('/utenti/:id', {
				templateUrl: '/utenteDetails.html',
				controller: 'UtenteDetailCtrl'
			})
			.when('/utenti/pass/:id', {
				templateUrl: '/utentePass.html',
				controller: 'UtentePassCtrl'
			})
			;
	}]);
	
app.directive('ngConfirmClick', [function(){
	return {
		link: function (scope, element, attr) {
			var msg = attr.ngConfirmClick || "Are you sure?";
			var clickAction = attr.confirmedClick;
			element.bind('click', function(event) {
				if (window.confirm(msg)) {
					scope.$eval(clickAction)
				}
			});
		}
	};
}])
</script>

<!-- Update navbar active -->
<script>
$(".nav a").on("click", function(){
   $(".nav").find(".active").removeClass("active");
   $(this).parent().addClass("active");
});
</script>

<footer class="container-fluid bg-4 text-center">
  <p>jsPratiche <!--made by <a href="http://www.miro.ovh">Miro Salvagni</a>--></p> 
</footer>


<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

</body>
</html>